<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MIDA Sandbox — UESC Contact Drill</title>
  <link rel="stylesheet" href="style.css" />
  <style>

  body{
  margin:0;
  overflow:hidden;
  background: #000; 
  color: #bdfcff; 
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}


    .frame{
      width: min(980px, calc(100% - 40px));
      margin: 22px auto;
      border-radius: 20px;
      border: 1px solid rgba(245,247,255,.12);
      background: linear-gradient(to bottom, rgba(255,255,255,.04), transparent 35%), rgba(7,8,12,.72);
      box-shadow: 0 22px 70px rgba(0,0,0,.55), 0 0 0 1px rgba(190,120,255,.10) inset;
      overflow:hidden;
      position: relative;
    }

.frame::before{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius: 22px;
  pointer-events:none;
  background:
    radial-gradient(520px 320px at 20% 10%, rgba(0,255,210,.18), transparent 60%),
    radial-gradient(520px 360px at 85% 40%, rgba(0,255,210,.12), transparent 62%);
  opacity: .9;
  filter: blur(12px);
  mix-blend-mode: screen;
}


    .top{
      display:flex;
      align-items:center;
      justify-content: space-between;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(245,247,255,.10);
      background:
        linear-gradient(to right, rgba(190,120,255,.16), rgba(90,170,255,.08)),
        rgba(0,0,0,.28);
      position: relative;
      z-index: 2;
      font-size: 12px;
      color: rgba(245,247,255,.72);
      letter-spacing: .2px;
    }

    .hud{
      display:flex;
      align-items:center;
      gap: 10px;
      white-space: nowrap;
    }
    .pill{
      border: 1px solid rgba(245,247,255,.14);
      background: rgba(0,0,0,.18);
      padding: 5px 10px;
      border-radius: 999px;
      color: rgba(245,247,255,.74);
    }
    .xmark{
      width: 18px;
      height: 18px;
      display:inline-grid;
      place-items:center;
      border-radius: 6px;
      border: 1px solid rgba(245,247,255,.12);
      background: rgba(0,0,0,.22);
      color: rgba(245,247,255,.75);
      font-weight: 900;
      line-height: 1;
    }
    .xmark::before{ content:"×"; }

    .stage{
      position: relative;
      z-index: 2;
      height: min(74vh, 720px);
      background: rgba(0,0,0,.20);
    }

    canvas{
      width: 100%;
      height: 100%;
      display:block;
    }

    /* overlays */
    .overlay{
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:.75;
      z-index: 3;
    }
    .scanlines{
      position:absolute;
      inset:0;
      background: repeating-linear-gradient(to bottom, rgba(255,255,255,.05), rgba(255,255,255,.05) 1px, transparent 1px, transparent 3px);
      opacity:.55;
      mix-blend-mode: overlay;
    }
    .noise{
      position:absolute;
      inset:0;
      background:
        repeating-linear-gradient(90deg, rgba(255,255,255,.03), rgba(255,255,255,.03) 1px, transparent 1px, transparent 4px),
        radial-gradient(900px 700px at 50% 40%, rgba(190,120,255,.10), transparent 62%);
      opacity:.55;
      animation: jitter .12s steps(2) infinite;
      filter: contrast(1.1);
      mix-blend-mode: screen;
    }
    @keyframes jitter{
      0%{ transform: translate(0,0); }
      25%{ transform: translate(1px,-1px); }
      50%{ transform: translate(-1px,1px); }
      75%{ transform: translate(2px,0); }
      100%{ transform: translate(0,0); }
    }

    /* center prompt */
    .banner{
      position:absolute;
      left: 14px;
      bottom: 14px;
      z-index: 4;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      color: rgba(245,247,255,.78);
      font-size: 12px;
    }

    .btn{
      pointer-events: auto;
      text-decoration:none;
      display:inline-block;
      border: 1px solid rgba(245,247,255,.14);
      background: rgba(0,0,0,.18);
      padding: 8px 10px;
      border-radius: 12px;
      color: rgba(245,247,255,.88);
      font-weight: 700;
    }
    .btn:hover{
      border-color: rgba(190,120,255,.35);
      box-shadow: 0 0 0 1px rgba(190,120,255,.14) inset;
    }

    /* game over modal */
    .modal{
      position:absolute;
      inset:0;
      display:none;
      place-items:center;
      z-index: 5;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(2px);
    }
    .modal.show{ display:grid; }

    .card{
      width: min(520px, calc(100% - 40px));
      border-radius: 16px;
      border: 1px solid rgba(245,247,255,.14);
      background: rgba(0,0,0,.35);
      padding: 16px;
      box-shadow: 0 22px 70px rgba(0,0,0,.6);
      color: rgba(245,247,255,.88);
    }
    .card h2{
      margin: 0 0 8px;
      font-size: 14px;
      letter-spacing: .4px;
    }
    .card p{
      margin: 6px 0 0;
      font-size: 12px;
      color: rgba(245,247,255,.70);
      line-height: 1.45;
    }
    .row{
      display:flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
  </style>
</head>

<body>
  <div class="frame">
    <div class="top">
      <div class="hud">
        <span class="xmark" aria-hidden="true"></span>
        <span class="xmark" aria-hidden="true"></span>
        <span>UE SC CONTACT DRILL</span>
      </div>
      <div class="hud">
        <span class="pill" id="hudStatus">status: live</span>
        <span class="pill" id="hudStats">hp: 3 · score: 0 · time: 0</span>
      </div>
    </div>

    <div class="stage">
      <canvas id="c" width="960" height="540"></canvas>

      <div class="overlay" aria-hidden="true">
        <div class="scanlines"></div>
        <div class="noise"></div>
      </div>

      <div class="banner">
        <span class="pill">WASD / arrows move</span>
        <span class="pill">Mouse or Space shoot</span>
        <span class="pill">Survive 30s. Freedom or death.</span>
        <a class="btn" href="terminal.html">Return to node</a>
      </div>

      <div class="modal" id="modal" aria-hidden="true">
        <div class="card">
          <h2 id="resultTitle">Result</h2>
          <p id="resultBody"></p>
          <div class="row">
            <button class="btn" id="retryBtn" type="button">Retry</button>
            <a class="btn" href="terminal.html">Back to terminal</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <audio id="glitchNoise" src="assets/glitch-noise.mp3" preload="auto"></audio>

  <script>
    (() => {
      const canvas = document.getElementById("c");
      const ctx = canvas.getContext("2d");

      const hudStats = document.getElementById("hudStats");
      const hudStatus = document.getElementById("hudStatus");

      const modal = document.getElementById("modal");
      const resultTitle = document.getElementById("resultTitle");
      const resultBody = document.getElementById("resultBody");
      const retryBtn = document.getElementById("retryBtn");

      const glitchNoise = document.getElementById("glitchNoise");

      function safePlay(a, {loop=false, volume=0.45} = {}) {
        if (!a) return;
        a.loop = loop; a.volume = volume;
        try { a.currentTime = 0; } catch {}
        const p = a.play();
        if (p && p.catch) p.catch(() => {});
      }
      function safeStop(a){
        if (!a) return;
        try { a.pause(); a.currentTime = 0; } catch {}
      }

      // Fit canvas to element size while preserving internal resolution scaling
      function resize() {
        const rect = canvas.getBoundingClientRect();
        const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
        canvas.width = Math.floor(rect.width * dpr);
        canvas.height = Math.floor(rect.height * dpr);
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      }
      window.addEventListener("resize", resize);

      const keys = new Set();
      window.addEventListener("keydown", (e) => {
        if (["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].includes(e.key)) e.preventDefault();
        keys.add(e.key.toLowerCase());
      }, {passive:false});
      window.addEventListener("keyup", (e) => keys.delete(e.key.toLowerCase()));

      let mouse = { x: 0, y: 0, down: false };
      canvas.addEventListener("mousemove", (e) => {
        const r = canvas.getBoundingClientRect();
        mouse.x = e.clientX - r.left;
        mouse.y = e.clientY - r.top;
      });
      canvas.addEventListener("mousedown", () => { mouse.down = true; });
      window.addEventListener("mouseup", () => { mouse.down = false; });

      function rand(min, max) { return Math.random() * (max - min) + min; }
      function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

      // Game state
      const DURATION = 30; // seconds to survive
      let running = true;
      let t0 = 0;
      let last = 0;

      let score = 0;
      let hp = 3;
      let timeAlive = 0;

      const player = {
        x: 0, y: 0, s: 12,
        speed: 220, // px/s
        fireCooldown: 0
      };

      const bullets = [];
      const enemies = [];
      let spawnTimer = 0;

      function reset() {
        running = true;
        score = 0;
        hp = 10;
        timeAlive = 0;
        bullets.length = 0;
        enemies.length = 0;
        spawnTimer = 0;
        player.fireCooldown = 0;

        const r = canvas.getBoundingClientRect();
        player.x = r.width * 0.5;
        player.y = r.height * 0.55;

        modal.classList.remove("show");
        modal.setAttribute("aria-hidden", "true");
        hudStatus.textContent = "status: live";
        safeStop(glitchNoise);

        t0 = performance.now();
        last = t0;
      }

      function spawnEnemy() {
        const r = canvas.getBoundingClientRect();
        // Spawn near edges
        const side = Math.floor(Math.random() * 4);
        let x, y;
        if (side === 0) { x = rand(0, r.width); y = -20; }
        if (side === 1) { x = r.width + 20; y = rand(0, r.height); }
        if (side === 2) { x = rand(0, r.width); y = r.height + 20; }
        if (side === 3) { x = -20; y = rand(0, r.height); }

        enemies.push({
          x, y, s: 14,
          speed: rand(70, 120) + timeAlive * 1.4, // ramps slightly
          hit: false
        });
      }

      function shoot() {
        if (player.fireCooldown > 0) return;
        player.fireCooldown = 0.16; // seconds

        const r = canvas.getBoundingClientRect();
        const tx = mouse.x || r.width * 0.5;
        const ty = mouse.y || r.height * 0.5;

        const dx = tx - player.x;
        const dy = ty - player.y;
        const mag = Math.hypot(dx, dy) || 1;

        bullets.push({
          x: player.x,
          y: player.y,
          vx: (dx / mag) * 520,
          vy: (dy / mag) * 520,
          life: 1.2
        });
      }

      function rectHit(ax, ay, as, bx, by, bs) {
        return Math.abs(ax - bx) < (as + bs) * 0.5 && Math.abs(ay - by) < (as + bs) * 0.5;
      }

      function end(result) {
        running = false;
        hudStatus.textContent = "status: terminated";
        safePlay(glitchNoise, {loop:false, volume:0.55});

        modal.classList.add("show");
        modal.setAttribute("aria-hidden", "false");
        resultTitle.textContent = result === "win" ? "SIM COMPLETE" : "SIM FAILED";

        if (result === "win") {
          resultBody.textContent =
            `UESC contacts evaded. Score ${score}. Time ${Math.floor(timeAlive)}s. MIDA notes: You persist.`;
        } else {
          resultBody.textContent =
            `UESC agents overwhelmed your position. Score ${score}. Time ${Math.floor(timeAlive)}s. MIDA notes: Your death was valued.`;
        }
      }

      function update(dt) {
        const r = canvas.getBoundingClientRect();

        // movement
        let mx = 0, my = 0;
        if (keys.has("w") || keys.has("arrowup")) my -= 1;
        if (keys.has("s") || keys.has("arrowdown")) my += 1;
        if (keys.has("a") || keys.has("arrowleft")) mx -= 1;
        if (keys.has("d") || keys.has("arrowright")) mx += 1;

        const m = Math.hypot(mx, my) || 1;
        mx /= m; my /= m;

        player.x = clamp(player.x + mx * player.speed * dt, player.s, r.width - player.s);
        player.y = clamp(player.y + my * player.speed * dt, player.s, r.height - player.s);

        // shooting
        player.fireCooldown = Math.max(0, player.fireCooldown - dt);
        if (mouse.down || keys.has(" ")) shoot();

        // spawn enemies (ramps up)
        spawnTimer -= dt;
        const spawnRate = Math.max(0.28, 0.9 - timeAlive * 0.01); // faster over time
        if (spawnTimer <= 0) {
          spawnEnemy();
          spawnTimer = spawnRate;
        }

        // bullets
        for (let i = bullets.length - 1; i >= 0; i--) {
          const b = bullets[i];
          b.x += b.vx * dt;
          b.y += b.vy * dt;
          b.life -= dt;

          if (b.life <= 0 || b.x < -40 || b.x > r.width + 40 || b.y < -40 || b.y > r.height + 40) {
            bullets.splice(i, 1);
          }
        }

        // enemies move toward player
        for (let i = enemies.length - 1; i >= 0; i--) {
          const e = enemies[i];
          const dx = player.x - e.x;
          const dy = player.y - e.y;
          const mag = Math.hypot(dx, dy) || 1;
          e.x += (dx / mag) * e.speed * dt;
          e.y += (dy / mag) * e.speed * dt;

          // collision with player
          if (rectHit(player.x, player.y, player.s, e.x, e.y, e.s)) {
            enemies.splice(i, 1);
            hp -= 1;
            safePlay(glitchNoise, {loop:false, volume:0.35});
            if (hp <= 0) {
              end("lose");
              return;
            }
          }
        }

        // bullet hits
        for (let i = enemies.length - 1; i >= 0; i--) {
          const e = enemies[i];
          for (let j = bullets.length - 1; j >= 0; j--) {
            const b = bullets[j];
            if (rectHit(b.x, b.y, 6, e.x, e.y, e.s)) {
              enemies.splice(i, 1);
              bullets.splice(j, 1);
              score += 1;
              break;
            }
          }
        }

        // win condition
        timeAlive += dt;
        if (timeAlive >= DURATION) end("win");
      }

      function draw() {
        const r = canvas.getBoundingClientRect();
        ctx.clearRect(0, 0, r.width, r.height);

        // arena grid
       ctx.globalAlpha = 0.12;
ctx.fillStyle = "rgba(0,255,210,0.6)";
for (let x = 0; x < r.width; x += 28) {
  ctx.fillRect(x, 0, 1, r.height);
}
for (let y = 0; y < r.height; y += 28) {
  ctx.fillRect(0, y, r.width, 1);
}
ctx.globalAlpha = 1;


      bullets.forEach(b => {
  ctx.fillRect(b.x - 2, b.y - 2, 4, 4);
});


        // enemies (UESC agents) BOOOOOUH
       ctx.fillStyle = "#0b1c3d"; // dark blue UESC
ctx.shadowColor = "#1a3a8a";
ctx.shadowBlur = 8;
enemies.forEach(e => {
  ctx.fillRect(e.x - e.s/2, e.y - e.s/2, e.s, e.s);
});
ctx.shadowBlur = 0;


        // player (MIDA asset) GLORY TO MARS
       ctx.fillStyle = "#c9a8ff"; // lavender player
ctx.shadowColor = "#c9a8ff";
ctx.shadowBlur = 14;
ctx.fillRect(player.x - player.s/2, player.y - player.s/2, player.s, player.s);
ctx.shadowBlur = 0;


        // HUD text
        hudStats.textContent = `hp: ${hp} · score: ${score} · time: ${Math.floor(timeAlive)}`;
      }

      function loop(now) {
        if (!running) return;

        const dt = Math.min(0.033, (now - last) / 1000);
        last = now;

        update(dt);
        draw();

        requestAnimationFrame(loop);
      }

      retryBtn.addEventListener("click", () => {
        resize();
        reset();
        requestAnimationFrame(loop);
      });

      // init
      resize();
      reset();
      requestAnimationFrame(loop);
    })();
  </script>
</body>
</html>
